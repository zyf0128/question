## Redis面试题

1. 什么是redis?
    
    - redis的全称是: `Remote Dictionary Server`,本质上是一个`Key-Val` 类型的数据库.整个数据库统统加载在`内存`当中进行操作，定期通过异步操作把数据库数据 `刷新到硬盘`上进行保存。
    
    - 因为是纯内存操作,因此性能十分出色.每秒可以处理`10万次的读写操作`.是已知性能最快的 Key-Value 数据库。
    
    - Redis最大的魅力在于`支持保存多种数据结构`,单个value的最大限制是1GB,不像memcached只能保存 1MB 的数据,因此Redis可以有很多有用的功能.
      - 比方说用他的 List 来做 FIFO 双向链表，实现一个轻量级的高性能消息队列服务，用他的 Set 可以做高性能的 tag 系统等等。
    - Redis`可以对存入的 key-val 设置过期时间(expire)` ,因此可以被当作一个功能加强版的memcached 来用.
    - Redis的`主要缺点`: 数据库容量容易受到物理内存的限制,不能用作海量数据的高性能读写,因此`redis适合的场景主要局限在数据量较小的高性能操作和运算上`
    
    
    
2. Redis 与 memcached 相比有哪些优势？

     - memcached 所有的值均是简单的字符串，redis支持`更为丰富的数据类型`
     - redis 的`速度`比 memcached `快`很多
     - redis 可以`持久化`其数据

3. Redis 支持哪几种数据类型？

     - String、List、Set、hashes、 Sorted Set (也叫 ZSet)

4. Redis 主要消耗什么物理资源？

     - 内存

5. Redis 有哪几种数据淘汰策略？

     1. `noeviction`: 当内存使用达到阈值的时候，所有引起申请内存的命令会报错。   
     2. `allkeys-lru`: 尝试回收最少使用的键（LRU），使得新添加的数据有空间存放。   
     3. `volatile-lru`: 尝试回收最少使用的键（LRU），但仅限于在过期集合的键,使得新添加的数据有空间存放。   
     4. `allkeys-random`: 回收随机的键使得新添加的数据有空间存放
     5. `volatile-random`: 回收随机的键使得新添加的数据有空间存放，但仅限于在过期集合的键。   
     6. `volatile-ttl`: 回收在过期集合的键，并且优先回收存活时间（TTL）较短的键,使得新添加的数据有空间存放。

6. Redis 官方为什么不提供 Windows 版本？ 

     - 因为目前 Linux 版本已经相当稳定，而且用户量很大，无需开发 windows 版本，反而会带来兼容性等问题。

7. 1个字符串类型的值能存储最大容量是多少？ 

     - 512M

8. 为什么 Redis 需要把所有数据放到内存中？

     - Redis `为了达到最快的读写速度`将数据都读到内存中，并通过异步的方式将数据写入磁盘。所以 redis 具有快速和数据持久化的特征，如果不将数据放在内存中，磁盘 I/O 速度为严重影响 redis 的性能。   
     - 在内存越来越便宜的今天，redis 将会越来越受欢迎， 如果设置了最大使用的内存，则数据已有记录数达到内存限值后不能继续插入新值。

9. Redis 集群方案应该怎么做？都有哪些方案？ 

     1. `codis` : 目前用的最多的集群方案，基本和twemproxy一致的效果，但它支持在 节点数量改变情况下，旧节点数据可恢复到新hash节点

     2. `twemproxy`，大概概念是，它类似于一个代理方式，使用方法和普通 redis无任何区别，设置好它下属的多个redis实例后，使用时在本需要连接redis的地方改为连接twemproxy，它会以一个代理的身份接收请求并使用一致性hash算法，将请求转接到具体redis，将结果再返回twemproxy。使用方式简便(相对redis只需修改连接端口)，对旧项目扩展的首选。`问题`twemproxy自身单端口实例的压力，使用一致性hash后，对redis节点数量改变时候的计算值的改变，数据无法自动移动到新的节点

     3. 在业务代码层实现，起几个毫无关联的redis实例，在代码层，对key 进行hash计算，然后去对应的redis实例操作数据。 这种方式对hash层代码要求比较高，考虑部分包括，节点失效后的替代算法方案，数据震荡后的自动脚本恢复，实例的监控，等等。

        

10. Redis 集群方案什么情况下会导致整个集群不可用？ 

     - 有 A，B，C 三个节点的集群,在没有复制模型的情况下,如果节点 B 失败了，那么整个集群就会以为缺少 5501-11000 这个范围的槽而不可用。

     ***

     - 当访问一个 Master 和 Slave 节点都挂了的槽的时候，会报槽无法获取。
     - 当集群 Master 节点个数小于 3 个的时候，或者集群可用节点个数为偶数的时候，基于 fail 的这种选举机制的自动主从切换过程可能会不能正常工作，一个是标记 fail 的过程，一个是选举新的 master 的过程，都有可能异常。

11. MySQL 里有 2000w 数据，redis 中只存 20w 的数据，如何保证 redis 中的数据都是热点数据？

      - redis 内存数据集大小上升到一定大小的时候，就会施行`数据淘汰策略`。

12. Redis 有哪些适合的场景？

      1. `会话缓存`（Session Cache）
         - 会话缓存（session cache），用 Redis 缓存会话比其他存储（如Memcached）的优势在于：`Redis 提供持久化`。
         - 当维护一个不是严格要求一致性的缓存时，如果用户的购物车信息全部丢失，大部分人都会不高兴的，现在，他们还会这样吗？幸运的是，随着Redis 这些年的改进，很容易找到怎么恰当的使用 Redis 来缓存会话的文档。甚至广为人知的商业平台 Magento 也提供 Redis 的插件。
      2. `全页缓存（FPC）`
         - 除基本的会话 token 之外，Redis 还提供很简便的 FPC (Full Page Catch)平台。
         - 回到一致性问题，即使重启了 Redis 实例，因为有磁盘的持久化，用户也不会看到页面加载速度的下降，这是一个极大改进.   
      3. `队列 `
         - Reids 在内存存储引擎领域的一大优点是提供 list 和 set 操作，这使得 Redis 能作为一个`很好的消息队列平台`来使用。
         - Redis 作为队列使用的操作，就类似于本地程序语言（如 Python）对 list 的 push/pop 操作。   
         - 如果你快速的在 Google 中搜索“Redis queues”，你马上就能找到大量的开源项目，这些项目的目的就是利用 Redis 创建非常好的后端工具，以满足各种队列需求。
      4. `排行榜/计数器` 
         - Redis 在内存中对数字进行递增或递减的操作实现的非常好。
         - 集合（Set）和有序集合（SortedSet）的操作非常简单,因此得到一个排行榜十分简单
      5. `发布/订阅` 
         - 最后（但肯定不是最不重要的）是 Redis 的发布/订阅功能。
         - 发布/订阅的使用场景确实非常多。我已看见人们在社交网络连接中使用，还可作为基于发布/订阅的脚本触发器，甚至用 Redis 的发布/订阅功能来建立聊天系统.

13. Redis 支持的 Java 客户端都有哪些？官方推荐用哪个？

      - `Redisson`、Jedis、lettuce 等等，

      - 官方推荐使用 `Redisson`。

14. Redis 和 Redisson 有什么关系？

      - Redisson 是一个高级的分布式协调 Redis 客户端，能帮助用户在 分布式环境中 轻松实现一些 Java 的对象 
      - 包括: Bloom filter, BitSet, Set, SetMultimap, ScoredSortedSet, SortedSet, Map, ConcurrentMap, List, ListMultimap, Queue, BlockingQueue, Deque, BlockingDeque, Semaphore, Lock, ReadWriteLock, AtomicLong, CountDownLatch, Publish / Subscribe, HyperLogLog 。

15. Jedis 与 Redisson 对比有什么优缺点？

      - Jedis 是 Redis 的 Java 实现的客户端，其 API 提供了比较全面的 Redis 命令的支持；  
      - Redisson 实现了分布式 和 可扩展的 Java 数据结构，和 Jedis 相比，功能较为简单，不支持字符串操作，不支持排序、事务、管道、分区等 Redis 特性。
      - Redisson 的宗旨是促进使用者对 Redis 的关注分离，从而让使用者能够将精力更集中地放在处理业务逻辑上

16. 说说 Redis 哈希槽的概念？

      - Redis 集群没有使用一致性 hash,而是引入了哈希槽的概念，Redis 集群有 16384 个哈希槽，每个 key 通过 CRC16 校验后对 16384 取模来决定放置哪个槽，集群的每个节点负责一部分 hash 槽。

17. Redis 集群的主从复制模型是怎样的？

      - 为了使在部分节点失败 或者 大部分节点无法通信的情况下集群仍然可用，所以集群使用了`主从复制模型`,每个节点都会有 N-1 个复制品. 

18. Redis 集群会有写操作丢失吗？为什么？

      - Redis 并不能保证数据的强一致性，这意味这在实际中集群在特定的条件下可能会丢失写操作

19. Redis 集群之间是如何复制的？

      - 异步复制 

20. Redis 集群最大节点个数是多少？

      - 16384 

21. Redis 集群如何选择数据库？

      - Redis 集群目前无法做数据库选择，默认在 0 数据库。

22. Redis 中的管道有什么用?

      - 在一次请求 / 响应中:  即使旧的请求还未被响应,服务器也能实现处理新的请求，这样就可以将多个命令发送到服务器，而不用等待回复，最后在一个步骤中读取该答复。  这就是管道（pipelining），是一种几十年来广泛使用的技术。例如许多 POP3 协议已经实现支持这个功能，大大加快了从服务器下载新邮件的过程